#!/bin/bash
echo "post-stop: $SERVICE_RESULT $EXIT_CODE $EXIT_STATUS"

[ "$SERVICE_RESULT" = success ] && exit

[ "$4" = user ] || [ "$4" = user-runtime-dir ] && exit
user="$1"
host="$2"
unit="$3"
full="$5"

if [ "$user" = root ]; then
  kpush=/opt/dotfiles/kpush
else
  flags=--user
  kpush=~/bin/kpush
  host="$user@$host"
fi

host+=": $unit: $SERVICE_RESULT $EXIT_CODE $EXIT_STATUS"
if [ "$SERVICE_RESULT" = success ]; then
  $kpush -t "$host  #fail" ''
else
  systemctl $flags status "$full" | $kpush -t "<b>$host</b>  #fail"
fi
